We have great plans for Picstome to make it more useful for photographers, especially when showcasing work like [portfolios](https://github.com/picstome/picstome/issues/85) or external links like [biolinks](https://github.com/picstome/picstome/issues/32). However, we currently don't have an option for users to have a handle like picstome.com/@oliver, so we needed to tackle this issue first.

The plan was that with every new user registration, we would also generate a unique username based on the provided user name, which they could later change from the branding settings page.

I opted to create a new service class to handle all the logic related to the generation of a unique handle by checking if a user handle exists and appending an incremental numeric value when it does.

```php
namespace App\Services;

use App\Models\Team;
use Illuminate\Support\Str;

class HandleGenerationService
{
    public function generateFromName(string $name): string
    {
        return Str::slug($name, '');
    }

    public function generateUniqueHandle(string $name): string
    {
        $baseHandle = $this->generateFromName($name);
        $handle = $baseHandle;
        $counter = 1;

        while (Team::where('handle', $handle)->exists()) {
            $handle = $baseHandle . $counter;
            $counter++;
        }

        return $handle;
    }
}
```

Next, because we already have registered users, we needed to automatically generate a handle for all our existing users.

To solve this, I created an artisan command to find users without a handle and generate a unique handle for each one. We use the concept of teams, so each user has a personal team, and I needed to update the personal team handle with an autogenerated one.

```php
// app/Console/Commands/BackfillTeamHandlesCommand.php

class BackfillTeamHandlesCommand extends Command
{
    protected $signature = 'teams:backfill-handles';

    protected $description = 'Backfill handles for existing teams that don\'t have one';

    public function handle()
    {
        $this->info('Backfilling handles for existing teams...');

        $teamsWithoutHandles = Team::whereNull('handle')->get();

        if ($teamsWithoutHandles->isEmpty()) {
            $this->info('No teams found that need handles');
            $this->info('Backfill completed successfully');
            return;
        }

        $handleGenerator = new HandleGenerationService();
        $processed = 0;

        foreach ($teamsWithoutHandles as $team) {
            $team->update(['handle' => $handleGenerator->generateUniqueHandle($team->name)]);
            $processed++;
        }

        $this->info("Processed {$processed} teams");
        $this->info('Backfill completed successfully');
    }
}
```

Here, creating a service class was helpful because now I can also use it to generate a unique handle for existing users.

Now that all users have a handle, I worked on allowing users to change their user handle whenever they wanted to.

Updating the handle value is not complex, but it requires some strict validation rules. The most important one is that the user handle is not used by another user.

```php
// app/Livewire/Forms/BrandingForm.php

class BrandingForm extends Form
{
    //...

    public function rules()
    {
        return [
            'handle' => [
                'required',
                'string',
                'lowercase',
                'min:2',
                'max:50',
                'regex:/^[a-z0-9]+$/',
                'unique:teams,handle,' . ($this->team->id ?? 'null'),
            ],
        ];
    }
}
```

Lastly, I now needed to register a new route to handle the user handles. Because this is the first step for more functionality for the user handles, it simply shows a welcome page.

```php
// routes/web.php

Route::get('/@{handle}', [HandleController::class, 'show'])->where('handle', '[a-zA-Z0-9_]+')->name('handle.show');
```

```php
// app/Http/Controllers/HandleController.php

class HandleController extends Controller
{
    public function show(Request $request, string $handle)
    {
        $team = Team::where('handle', strtolower($handle))->first();

        abort_if(!$team, 404);

        return view('team.show', ['team' => $team]);
    }
}
```

Perfect, we now have the minimal functionality to handle user handles. My next task will be to implement showcasing galleries as a portfolio and showing bio links on the public handle page.

You can also check our project repository to take a look at our source code; maybe this implementation is also useful for your projects.
